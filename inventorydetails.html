{% extends 'base.html' %}
{% block content %}
{% load static %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="//code.jquery.com/jquery-1.12.4.js"></script>
<script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>

  
  h2{
    font-size: small;
    font-family: 'Segoe UI', Tahoma,;
    color:#dfe4e9;
  }
table {
  font-family: arial, sans-serif;

  width: 100%;
}

td, th {
  border: 1px solid #1f1c1c;
  text-align: left;
  padding: 4px;
  color:#e5d7d7;
  font-weight: 100;
  font-size: small;
  font-family: 'Segoe UI', Tahoma,;
}
table,tr {
  border: hidden;
 
}
tr:nth-child(odd) {
  
    color:#e5d7d7;
    background-color:#ada0a0 ;
  }
  tr:nth-child(even) {
    color:#efe4e4;
    background-color: #0b09092a;
  }


  #aover{
    color: rgb(214, 141, 5);
  }
/* #aover:hover{
  font-weight: bold;
} */
tr:hover{
  background-color: rgb(146, 137, 137);
  font-weight: bold;

}


    /* width */
    ::-webkit-scrollbar {
        width: 10px;
    }

    /* Track */
    ::-webkit-scrollbar-track {
        background: rgb(108, 108, 104);

    }

    /* Handle */
    ::-webkit-scrollbar-thumb {
        background: #e0dcdc;
    }

    /* Handle on hover */
    ::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
    #selected-area{
        font-size: 20px;
    }
  


    
</style>


        

<style>
 /* Style for calendar input fields */
.inputdate {
  width: 150px;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
}
.inputdate1 {
  width: 150px;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 14px;
}

/* Style for calendar icon */
.ui-datepicker-trigger {
  margin-left: 5px;
  cursor: pointer;
}

/* Style for the datepicker dropdown */
.ui-datepicker {
  font-size: 14px;
}
.hide-calendar .ui-datepicker-calendar {
    display: none;
  }

/* Style for the datepicker header */
.ui-datepicker-header {
  background-color: #333;
  color: #fff;
  border: 1px solid #555;
}

.hidden {
        display: none;
    }
/* Style for the datepicker days */


/* Style for the datepicker navigation buttons */
.ui-datepicker-prev, .ui-datepicker-next {
  background-color: #555;
  color: #fff;
  padding: 5px;
  border: none;
  cursor: pointer;
}
#selectedFromDate,
  #selectedToDate {
    display: inline-block;
    margin-right: 5px; /* Add space between the two h5 tags */
  }
    .bar {
        align-items: center;
        display: flex;
        justify-content: space-between;
    }
    .bar .left{
    display: grid;
    grid-template-columns: 1fr 1fr;
}
.bar .left input{
    height: 5vh;
}
.btn {
  background-color: white;
  border: none;
  color: green;
  padding: 12px 16px;
  font-size: 16px;
  cursor: pointer;
}

/* Darker background on mouse-over */
.btn:hover {
  background-color: white;
}
@media print {
        body * {
            visibility: hidden;
        }

        header {
            display: none;
        }

        .print-only * {
            visibility: visible;
            
        }

        .print-only {
            color: black;
            /* position: absolute; */

            /* position: fixed; */
            left: 0;
            top: 0;
            right: 0;
            height: auto;
            /* page-break-before: always;
            page-break-inside: avoid; */
        }

        @page {
            size: 100%;
            margin: 0;
            height: auto;
        }

        .print-only .table {
            border-collapse: collapse;
            width: 100%;
            /* Set the width to 100% of the printed page */
            margin: 0;
            /* Remove margins to maximize the width */
        }

        .print-only th,
        .print-only td {
            padding: 8px;
            /* Add padding for better readability */
            text-align: center;
            /* Center-align text in cells */
        }

    }
</style>


  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
 
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<body>
  <div class="page-content">
   
        <div class="card-body">
            <div class="card-title">
  <div class="card-body">
    <div class="bar">
     
        <div class=" left">
            <div class="px-2">
              <label style="text-align:left ">From</label>
              <input id="inputdate" id="datepicker" class="inputdate"   value="DD-MM-YY" /> 
            </div>
            <div  class="px-2">
              <label style="text-align:left ">To</label>
              <input id="inputdate1"  class="inputdate1"  value="DD-MM-YY"/>
              
            </div>

        </div>

  
               
        <div class="d-flex">
                 
                  <button  class="btn btn_print btn-outline-info"  style="background: white; color: rgb(16, 135, 46);"><i class="fa fa-print"></i></button>
                  <div style="width:3px;"></div>
                  <div class="dropdown">
                    <button  class="btn btn-light dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="background: white; color: rgb(16, 135, 46);">
                      <i class="fa fa-file-excel"></i> </button>
                   
                    <div class="dropdown-menu" aria-labelledby="exportDropdown">
                        <a class="dropdown-item" href="#" onclick="exportAsPDF()">PDF</a>
                        <a class="dropdown-item" href="#"onclick="ExportToExcel('xlsx')">XLS (Excel)</a>
                    </div>  
                    <button class="btn" ><a onclick ="javascript:history.go(-1);" class="fa fa-close" style="background: white; color: rgb(16, 135, 46);"></a></button>
                  </div>
                </div>
            </div>
            <BR><BR><BR>
        
            <div  id="pdf-card" >
              <div class="container-fluid" id="tbl_exporttable_to_xls">
                <div class="table-responsive"  > 


                  <div id="print-button" >
   

                    <div class="printable-content" class="printable-wrapper">
                <div class="card-body" id="container-to-print" >
            
                  <div class="card-title">
                    <div  style="top: 7rem; " >
                      <center>
                        <div class="row">
                          {% if company.company_name != None %}
                           <div  ><h4 class="text text-light"  style="font-size: 30px;"
                            >{{company.company_name }}
                            {% else %}
                             Add Company</h4>
                    
                            </div>
                            {% endif %}    

                           <div >     <center id="h1-content">
                            {% if inv.product != None %}
                            <div  ><h2 class="align-text-top" style="font-size: 35px;"
                             >{{inv.product}}
                             {% else %}
                             Inventory Details</h2>
                     
                             </div>
                             {% endif %}    
 
                           
                           </div>
                           <h5 class="text text-light" id="selectedFromDate"></h5>-
                           <h5 class="text text-light" id="selectedToDate"></h5>
                    
                            </div>
                        </div>   
                      </center>
                      <div class="container-fluid">
                        <div class="mt-3">
                          <input type="text"  id="searchInput" class="form-control bg-dark" placeholder="Search Items..." style="color: rgb(255, 255, 255);background: transparent;width: 20vw;"  name="party" list="party" class="form-control" id="pin">
                            
                            <datalist id="party">
                              {% for i in inv %}
                              <option value="{{i.product}}">
                                  {% endfor %}
                                  {% for i in recur %}
                              <option value=" {{i.iname}}">
                                  {% endfor %}
                                  {% for i in pars %}
                                  <option value=" {{i.item}}">
                                      {% endfor %}
                          </datalist>
                        
                        </div>
          
                  
                      <hr>
              
        

      <table class="table2excel  table table-responsive-md mt-4 table-hover table-bordered"
                    style="background-color: rgba(0, 0, 0, 0.2);" id="myTable2">

      <table class="table table-bordered table-striped mt-4 " id="dataTable"  style="margin: 0px auto;">
                  
                  
      <thead>
        <thead >
               
          <tr style="background-color: rgba(61, 59, 59, 0.2);color: white" >
            <th class="hidden"></th>
            <th>Date</th>
            <th class="table">Type</th>
         
            <th class="table">Sale Quantity</th>
            <th class="table">Purchase Quantity	</th>
            <th class="table">Adjustment Quantity	</th>	
            <th class="table">Closing Quantity</th>
          </tr> 
        </thead>

      <tbody>
        {% for p in inv %} 
        <tr class="text-center" style="display: none;" id="tb">
     
                          
      
          <td style="display: none;" id="tb">{{p.product}}</td>              
          <td>{{p.inv.inv_date }}</td>
          <td>invoice</td>     
          
       
          <td>{{p.quantity}}</td>
     
       
          <td>0</td>
          <td>0</td>
          <td>0</td>
  
        </tr>  
        {% endfor %} 
        {% for p in recur %} 
                            
          <tr class="text-center" style="display: none;" id="tb">
     
        
            <td style="display: none;" id="tb">{{p.iname}}</td>              
            <td>{{p.ri.start}}</td>
            <td>{{p.ri.entry_type}}</td>     
            
         
            <td>{{p.quantity}}</td>
       
         
            <td>0</td>
            <td>0</td>
            <td>0</td>
    
          </tr>  
            {% endfor %} 
            {% for p in pars %} 
            <tr class="text-center" style="display: none;" id="tb">
         
                              
          
              <td style="display: none;"  id="tb">{{p.item}}</td>              
              <td>{{p.PO.Ord_date }}</td>
              <td>{{p.PO.typ }}</td>     
              
           
              <td>0</td>
         
           
              <td>{{p.quantity}}</td>
              <td>0</td>
              <td>0</td>
      
            </tr>  
              {% endfor %} 
        
  </DIV></table></div></div>


</div></div></div></div>
<script>
  $('.inputdate').datepicker( {
             changeMonth: true,
             changeYear: true,
             showButtonPanel: true,
             dateFormat: 'dd MM yy',
             onSelect: function(dateText, inst) {
       $('#selectedFromDate').text('From'+'  ' + dateText);
     }
         });
         $('.inputdate1').datepicker( {
              changeMonth: true,
              changeYear: true,
              showButtonPanel: true,
              dateFormat: 'dd MM yy',
              onSelect: function(dateText, inst) {
       $('#selectedToDate').text('To'+'  ' + dateText);
     }
          });
 </script>
 
 <script>
  // Get the table element by its ID
  var table = document.getElementById("myTable");

  // Get the table body
  var tbody = table.getElementsByTagName("tbody")[0];

  // Get all rows in the table body
  var rows = tbody.getElementsByTagName("tr");

  // Iterate through each row and set the serial number
  for (var i = 0; i < rows.length; i++) {
      // Get the first existing table cell (td) in the current row
      var firstCell = rows[i].getElementsByTagName("td")[0];

      // Set the serial number as the row number (plus 1) in the first cell
      firstCell.textContent = i + 1;
  }
</script>          
<script type="text/javascript">
  $(document).ready(function ($) {
      console.log('print');

      $(document).on('click', '.btn_print', function (event) {
          console.log('print1');
          event.preventDefault();
         
          const pdfCard = document.getElementById('pdf-card').cloneNode(true);

          // Create a new window for printing
          const printWindow = window.open('', '');

          const pageTitle = printWindow.document.createElement('h1');
          pageTitle.textContent = ''; // Replace 'Page Title' with your desired title text
          pageTitle.style.textAlign = 'center';
          pageTitle.style.color = 'black';

          // Append the <h1> element to the new window's body
          printWindow.document.body.appendChild(pageTitle);
          const pdfOptions = {
        margin: 0,
        filename: '{{company_data.company_name}}inv.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },
      };
    

          // Append the cloned 'pdf-card' div to the new window
          printWindow.document.body.appendChild(pdfCard);

          // Ensure the styles are preserved by copying CSS from the original document
          const stylesheets = document.styleSheets;
          for (let i = 0; i < stylesheets.length; i++) {
              const stylesheet = stylesheets[i];
              if (stylesheet.href) {
                  const link = printWindow.document.createElement('link');
                  link.rel = 'stylesheet';
                  link.href = stylesheet.href;
                  printWindow.document.head.appendChild(link);
              }
          }

          // Trigger the print dialog for the new window
          printWindow.print();

          // Close the new window after printing
          printWindow.close();


      });

  });
</script><script>
function exportAsPDF() {
  const container = document.getElementById('container-to-print');

  // Save the original background color
  const originalBackgroundColor = container.style.backgroundColor;

  // Set the container's background color to white
  container.style.backgroundColor = 'white';

  // Apply styling changes to the container's content
  const textWhiteElements = container.querySelectorAll('.text');
  textWhiteElements.forEach(element => {
    element.style.color = 'black'; // Set text color to black
  });

  const tableElements = container.querySelectorAll('table');
  const tableCells = container.querySelectorAll('td, th');
  const tableRows = container.querySelectorAll('tr');

  tableElements.forEach(table => {
    table.style.backgroundColor = '#ffffff'; // Set background color to white
    table.style.color = '#000000'; // Set text color to black
  });

  tableCells.forEach(cell => {
    cell.style.backgroundColor = '#ffffff'; // Set background color to white
    cell.style.color = '#000000'; // Set text color to black
    cell.style.border = '1px solid black'; // Add a black border
  });

  tableRows.forEach(row => {
    row.style.backgroundColor = '#000000'; // Set background color to black
  });

  const pdfOptions = {
    margin: 0,
    filename: '{{company_data.company_name}}inventory details.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' },
  };

  // Generate PDF from the container
  html2pdf().from(container).set(pdfOptions).save().then(() => {

    // Restore the original background color
    container.style.backgroundColor = originalBackgroundColor;

    textWhiteElements.forEach(element => {
      element.style.color = 'white'; // Restore original text color

    // Remove the pdf-background class after generating the PDF
    container.classList.remove('pdf-background');
    });
  });
}
</script>

<script>
$(document).ready(function($) {
$(".table-row").dblclick(function() {
    window.document.location = $(this).data("href");
});
});
</script>



<script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>

<script type="text/javascript">function ExportToExcel(type, fn, dl) {
var elt = document.getElementById('tbl_exporttable_to_xls');
var wb = XLSX.utils.table_to_book(elt, { sheet: "sheet1" });
return dl ?
 XLSX.write(wb, { bookType: type, bookSST: true, type: 'base64' }):
 XLSX.writeFile(wb, fn || ('inventorydetails.' + (type || 'xlsx')));
}
</script>
  
<script>
  // Function to handle the search
  function searchTable() {
    let input, filter, table, tr, td, i, j, txtValue;
    input = document.getElementById("searchInput");
    filter = input.value.toLowerCase();
    table = document.getElementById("dataTable");
    tr = table.getElementsByTagName("tr");

    // Loop through all table rows (excluding the first row, which contains the column headers)
    for (i = 1; i < tr.length; i++) {
      let rowVisible = false;
      td = tr[i].getElementsByTagName("td");

      // Loop through all table cells (columns) in each row
      for (j = 0; j < td.length; j++) {
        if (td[j]) {
          txtValue = td[j].textContent || td[j].innerText;
          if (txtValue.toLowerCase().indexOf(filter) > -1) {
            rowVisible = true;
            break;
          }
        }
      }

      // Show/hide the row based on the search results
      tr[i].style.display = rowVisible ? "" : "none";
    }
  }

  // Attach the search function to the input field's "input" event
  document.getElementById("searchInput").addEventListener("input", searchTable);
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

</style></div>
{% endblock %}